\RequirePackage{changepage}
\RequirePackage[inline]{enumitem}
\RequirePackage{layout}
\RequirePackage[h]{esvect}
\RequirePackage[noplaybutton]{media9}

\usepackage{eso-pic}
\usepackage{lipsum} % not used

\newcommand{\embedVideo}[1]{}
%\def \embedVideo#1{\fbox{%
%  \includemedia[%
%    width=.96\linewidth,%
%    height=0.54\linewidth,% 16:9
%    activate=pageopen,%
%    flashvars={%
%      modestbranding=1% no YT logo in control bar
%     &autohide=1% controlbar autohide
%     &showinfo=0% no title and other info before start
%     &rel=0% no related videos after end
%    }%
%   ]{%
%    %\href{https://www.youtube.com/v/#1?rel=0}{#1}% alt text
%   }{%
%    #1%https://www.youtube.com/v/#1?rel=0%
%   }%
%}}

\newcommand{\iframe}[3]{}

% page ref in tex is the page, in html is the section, **which isn't a number**
\def\isOnePageLong#1{\pageref{#1}=\pageref{e#1}}
\def\isOddPage#1{\isodd{\pageref{#1}}}

\long\def\coloredbox#1#2#3#4{%
\begin{tikzpicture}%
\ifthenelse{\boolean{inColor}}%
{\draw (\specialboxtitlelength,0) node[#1] {#3};}%
{\draw (\specialboxtitlelength,0) node[#2] {#3};}%
\end{tikzpicture}%
} % #4 is used only by latexml


%%%%
%%
%%  For figures in the margin
%%
%%%%

\ifthenelse{\boolean{longpage}}%
		{\newcommand{\mfigure}[5][]{%
		\vskip \baselineskip%
			\noindent\begin{minipage}{\textwidth}
  			\centering
  			\myincludegraphics{#5}
  			#1%
  			\captionsetup{type=figure}
	  		\caption{#3}\label{#4}
  		\end{minipage}
		}}
		{\newcommand{\mfigure}[5][]{%
		\ifthenelse{\isodd{\thepage}}%
			{\AddToShipoutPicture*{\put(427,\LenToUnit{#2\paperheight}){%
			\begin{minipage}{\marginparwidth}%
				\centering%
	  		\myincludegraphics[#1]{#5}%
  			\captionsetup{type=figure}%
  			%#1%
	  		\caption{#3}\label{#4}%
  		\end{minipage}}}}%
			{\AddToShipoutPicture*{\put(36,\LenToUnit{#2\paperheight}){%
			\begin{minipage}{\marginparwidth}%
			  \centering%
  			\myincludegraphics[#1]{#5}%
  			\captionsetup{type=figure}%
  			%#1%
	  		\caption{#3}\label{#4}%
  		\end{minipage}}}}%
		}}%

\ifthenelse{\boolean{longpage}}%
		{\newcommand{\mtable}[4]{
					\vskip \baselineskip%
					\noindent\begin{minipage}{\textwidth}
  					\centering\small
  					#4
  					\captionsetup{type=figure}
	  				\caption{#2}\label{#3}
  				\end{minipage}
  				\vskip\baselineskip}
  	}
		{\newcommand{\mtable}[4]{%
			\ifthenelse{\isodd{\thepage}}%
				{\AddToShipoutPicture*{\put(427,\LenToUnit{#1\paperheight}){%
					\begin{minipage}{\marginparwidth}%
  					\centering\small%
  					#4%
  					\captionsetup{type=figure}%
	  				\caption{#2}\label{#3}%
  				\end{minipage}}}}%
				{\AddToShipoutPicture*{\put(36,\LenToUnit{#1\paperheight}){%
					\begin{minipage}{\marginparwidth}%
 						 \centering\small%
 						 #4%
						  \captionsetup{type=figure}%
	  					\caption{#2}\label{#3}%
 					 \end{minipage}}}}%
		}}%

\ifthenelse{\boolean{longpage}}%
		{\newcommand{\mnote}[2]{%
					\hskip 25pt%
					\begin{minipage}{250pt}%
					\small%
					#2%
					\end{minipage}%
					\vskip\baselineskip%
		}%
		}%
		{\newcommand{\mnote}[2]{%
			\ifthenelse{\isodd{\thepage}}%
				{\AddToShipoutPicture*{\put(427,\LenToUnit{#1\paperheight}){%
					\begin{minipage}{\marginparwidth}
  					\small
  					#2
  				\end{minipage}}}}%
				{\AddToShipoutPicture*{\put(36,\LenToUnit{#1\paperheight}){%
					\begin{minipage}{\marginparwidth}
 						 \small
 						 #2
					\end{minipage}}}}
		}}

\newcommand{\mfigurethree}[6]{%
		\ifthenelse{\isodd{\thepage}}%
			{\AddToShipoutPicture*{\put(427,\LenToUnit{#3\paperheight}){%
			\begin{minipage}{\marginparwidth}%
				\centering%
				\ifthenelse{\boolean{in_threeD}}{% in 3D
	  		\includemedia[#1]{\includegraphics{#6_3D\colornamesuffix}}{#6_3D.prc}}%now not in 3D
				{\myincludegraphics[#2]{#6}}%
  			\captionsetup{type=figure}%
  			%#1%
	  		\caption{#4}\label{#5}%
  		\end{minipage}}}}%
			{\AddToShipoutPicture*{\put(36,\LenToUnit{#3\paperheight}){%
			\begin{minipage}{\marginparwidth}%
			  \centering%
  			\ifthenelse{\boolean{in_threeD}}{% in 3D
	  		\includemedia[#1]{\includegraphics{#6_3D\colornamesuffix}}{#6_3D.prc}}%now not in 3D
				{\myincludegraphics[#2]{#6}}%
  			\captionsetup{type=figure}%
  			%#1%
	  		\caption{#4}\label{#5}%
  		\end{minipage}}}}%
		}
    
%%%%
%% End margin figure 
%%%%    

%\makeatletter
\newcommand{\myincludegraphicsthree}{\@ifstar \myincludegraphicsthreestarred \myincludegraphicsthreenostar}
%\makeatother


% some exercise / answer related commands

\def\printexercises#1{\printexercisesgeneric{#1}{Exercises \arabic{chapter}.\arabic{section}}{\arabic{chapter}.\arabic{section}}}

\def\printexercisesreview#1{\printexercisesgeneric{#1}{Chapter \arabic{chapter} Review Exercises}{\arabic{chapter}}}

\newcommand{\myincludegraphicsthreenostar}[3]{{%
				\ifthenelse{\boolean{in_threeD}}{% in 3D
				\includemedia[#1]{\includegraphics{#3_3D\colornamesuffix}}{#3_3D.prc}}% now not in 3D
				{\myincludegraphics[#2]{#3}}}}

\newcommand{\myincludegraphicsthreestarred}[3]{{%
				\ifthenelse{\boolean{in_threeD}}{% in 3D
				\includemedia[#1]{\includegraphics{#3\colornamesuffix}}{#3_3D.prc}}% now not in 3D
				{\myincludegraphics[#2]{#3}}}}

\newcommand{\writeToAnsFile}[3]{%
\ifthenelse{\equal{\expandafter\readsection\thesection}{1}}{%
\immediate\write\answrite{}\write\answrite{\noexpand\noindent{\noexpand\Large\noexpand\textbf{Chapter \thechapter}}\noexpand\vskip\noexpand\baselineskip}%
}{%
% else
}% ends ifthenelse
\immediate\write\answrite{\noexpand\noindent {\noexpand\hyperref[exer#3]{\noexpand\textbf{#2}}\noexpand\label{sol#3}} \noexpand \vskip \baselineskip}%
\write\answrite{\noexpand\printanswers{#1}}%
}
