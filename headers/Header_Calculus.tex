\usepackage{fancyhdr}
%\pgfplotsset{width=\marginparwidth+1pt,compat=1.3}
\usepackage[font=small]{caption}
%,justification=centering

%\usepackage{wrapfig}

\usepackage{booktabs}

%%%%
%% These are low level LaTeX commands that determine the 
%% look of the Chapter and Section headings.
%% Note the use in the chapter part of an external file
%% that contains graphics for each chapter start.
%%%%

%%%%
%% Commands for the header, utilizing the fancyhdr
%% (fancy header) package
%%%%

\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}
\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter\ \ \ \ {#1}}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ \ \ \  #1}}
\fancyhf{}         %Clears all header and footer fields, in preparation.
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

\ifthenelse{\boolean{longpage}}%
{}% end header of longpage
{% begin header/footer of not longpage
\fancyhfoffset[LE,RO]{\marginparwidth+\marginparsep}
%\fancyfoot[LE,RO]{\textbf{\thepage}} %Displays the page number in bold in the header,

\fancyfoot[LE]{\begin{minipage}{\textwidth}%
\noindent\hskip\marginparwidth\hskip\marginparsep\hskip-4pt\rule{\textwidth}{.4pt}
\vskip.2\baselineskip
\noindent\hskip\marginparwidth\hskip\marginparsep\hskip-4pt%
Notes:
\vskip 1.5in\textbf{\thepage}
\end{minipage}} 

\fancyfoot[RO]{\begin{minipage}{\textwidth+\marginparwidth+\marginparsep}%
\rule{\textwidth-\marginparwidth-\marginparsep}{.4pt}
\vskip.2\baselineskip
Notes:
\vskip 1.5in
\hfill\textbf{\thepage}
\end{minipage}}       


\fancyhead[LE]{\nouppercase{\leftmark}}
      %Displays the upper-level (chapter) information---
      % as determined above---in non-upper case in the header, 
      %to the right on even pages.
\fancyhead[RO]{\rightmark}
			%Displays the lower-level (section) information---as
      % determined above---in the header, to the left on odd pages.
      
}% End the ifthenelse{longpage}


\ifthenelse{\boolean{longpage}}% for changing the header
{% longpage
\newcommand{\exerciseheader}{}
\newcommand{\regularheader}{}
\newcommand{\endmatheader}{}
}% i.e, the above does nothing
{% now for a real change
\newcommand{\exerciseheader}{%
	\fancyhfoffset[LE,RO]{32pt}%
	\fancyfoot[LE]{\textbf{\thepage}}% 
	\fancyfoot[RO]{\textbf{\thepage}}
	\fancyhead{}% 
}

\newcommand{\regularheader}{%
\fancyhead[LE]{\nouppercase{\leftmark}}%
\fancyhead[RO]{\rightmark}%
\fancyfoot[LE]{\begin{minipage}{\textwidth}%
\noindent\hspace{\marginparwidth}\hspace{\marginparsep}\hspace{-4pt}\rule{\textwidth}{.4pt}
\vspace{.2\baselineskip}
\noindent\hspace{\marginparwidth}\hspace{\marginparsep}\hspace{-4pt}%
%\noindent\hskip\marginparwidth\hskip\marginparsep\hskip-4pt\rule{\textwidth}{.4pt}
%\vskip.2\baselineskip
%\noindent\hskip\marginparwidth\hskip\marginparsep\hskip-4pt%
Notes:
\vskip 1.5in\textbf{\thepage}
\end{minipage}} 

\fancyfoot[RO]{\begin{minipage}{\textwidth+\marginparwidth+\marginparsep}%
\rule{\textwidth-\marginparwidth-\marginparsep}{.4pt}
\vskip.2\baselineskip
Notes:
\vskip 1.5in
\hfill\textbf{\thepage}
\end{minipage}}
\fancyhfoffset[LE,RO]{\marginparsep+\marginparwidth}
}

%\newcommand{\qendheader}{%
%		\fancyhead{}%
%		\fancyfoot{}%
%		}
}% ends if/then/else exercise/regular headers


%
%  Defining what the chapter titles look like
%

\newdimen\titleheight

\makeatletter
\def\@makechapterhead#1{%
  {\parindent \z@ \raggedright \reset@font
    {\Huge \thechapter: \scshape \textsc #1}
    \par\vskip 10\p@
    \hrule height 1pt
    \vskip 10\p@
  }}
%%  
%%%\makeatletter
%%\def\@makesectionhead#1{%
%%	 {\reset@font\LARGE\itshape\bfseries\strut #1 \thechapter.\thesection \ #1
%%	 }}
\makeatother 

\newcommand{\btz}{\begin{center}\begin{tikzpicture}}
\newcommand{\etz}{\end{tikzpicture}\end{center}}

\newcommand{\ds}{\displaystyle}

\newcommand{\fp}{\ensuremath{f\,'}}
\newcommand{\fpp}{\ensuremath{f\,''}}

\newcommand{\Fp}{\ensuremath{F\primeskip'}}
\newcommand{\Fpp}{\ensuremath{F\primeskip''}}

\newcommand{\yp}{\ensuremath{y\primeskip'}}
\newcommand{\gp}{\ensuremath{g\primeskip'}}

\newcommand{\dx}{\ensuremath{\Delta x}}
\newcommand{\dy}{\ensuremath{\Delta y}}
%\newcommand{\dz}{\ensuremath{\Delta z}}
\newcommand{\ddz}{\ensuremath{\Delta z}}

%\newcommand{\thet}{\ensuremath{\theta}}
\newcommand*{\abs}[1]{\ensuremath{\left\lvert #1 \right\rvert}}
\newcommand*{\norm}[1]{\ensuremath{\left\lVert #1 \right\rVert}}
\newcommand*{\vnorm}[1]{\ensuremath{\norm{\vec #1}}}
\newcommand*{\snorm}[1]{\norm{#1}}%{\ensuremath{\left\lVert\ #1\ \right\rVert}}
\newcommand{\la}{\left\langle}
\newcommand{\ra}{\right\rangle}
\newcommand*{\dotp}[2]{\ensuremath{\vec #1 \cdot \vec #2}}
\newcommand*{\proj}[2]{\ensuremath{\text{proj}_{\,\vec #2}{\,\vec #1}}}
\newcommand*{\crossp}[2]{\ensuremath{\vec #1 \times \vec #2}}
\newcommand{\veci}{\ensuremath{\vec\imath}}
\newcommand{\vecj}{\ensuremath{\vec\jmath}}
\newcommand{\veck}{\ensuremath{\vec k}}
\newcommand{\vecu}{\ensuremath{\vec u}}
\newcommand{\vecv}{\ensuremath{\vec v}}
\newcommand{\vecw}{\ensuremath{\vec w}}
\newcommand{\vecx}{\ensuremath{\vec x}}
\newcommand{\vecy}{\ensuremath{\vec y}}
\newcommand{\vrp}{\ensuremath{\vec r\primeskip '}}
\newcommand{\vsp}{\ensuremath{\vec s\primeskip '}}
\newcommand{\vrt}{\ensuremath{\vec r(t)}}
\newcommand{\vst}{\ensuremath{\vec s(t)}}
\newcommand{\vvt}{\ensuremath{\vec v(t)}}
\newcommand{\vat}{\ensuremath{\vec a(t)}}
\newcommand{\px}{\ensuremath{\partial x}}
\newcommand{\py}{\ensuremath{\partial y}}
\newcommand{\pz}{\ensuremath{\partial z}}
\newcommand{\pf}{\ensuremath{\partial f}}
\newcommand{\underlinespace}{\underline{\phantom{xxxxxx}}}

\newcommand{\mathN}{\ensuremath{\mathbb{N}}}

\newcommand{\zerooverzero}{\ensuremath{\ds \raisebox{8pt}{\text{``\ }}\frac{0}{0}\raisebox{8pt}{\text{\ ''}}}}


\newcommand{\myrule}{\iflatexml\else\rule[-4pt]{0pt}{13pt}\fi}
\newcommand{\mmrule}{\iflatexml\else\rule[-10pt]{0pt}{15pt}\fi}
\newcommand{\myds}{\ds\mmrule}
\newcommand*{\deriv}[2]{\ensuremath{\myds\frac{d}{dx}\left(#1\right)=#2}}
\newcommand*{\myint}[2]{\ensuremath{\myds\int #1\ dx=} \ensuremath{\ds #2}}


\DeclareMathOperator{\sech}{sech}
\DeclareMathOperator{\csch}{csch}

\newcommand*{\sword}[1]{\textbf{#1}}

\newcommand{\primeskip}{\hskip.75pt}

%%%% Begin Header TikZ

%  Some TiKZ  shortcuts to help make drawing 3D vectors faster.
%

\newcommand{\plotlinecolor}{blue}

%
% Draw x and y tick marks
%
\newcommand{\drawxticks}[1]
{\foreach \x in {#1}
		{\draw  (\x,-.1)--(\x,.1);
			};
}
\newcommand{\drawyticks}[1]
{\foreach \x in {#1}
		{\draw  (-.1,\x)--(.1,\x);
			};
}

\newcommand{\drawxlines}[3]
{\draw[<->] (#1,0) -- (#2,0) node [right] {$x$};
\foreach \x in {#3}
		{\draw  (\x,-.1)--(\x,.1);
			};
}

\newcommand{\drawylines}[3]
{\draw[<->] (0,#1) -- (0,#2) node [above] {$y$};
\foreach \x in {#3}
		{\draw  (-.1,\x)--(.1,\x);
			};
}

\newcommand{\drawxlabels}[1]
{\foreach \x in {#1}
		{\draw  (\x,-.1) node [below] {\scriptsize $\x$};
		};
}

\newcommand{\drawylabels}[1]
{\foreach \x in {#1}
		{\draw  (-.1,\x) node [left] {\scriptsize $\x$};
		};
}

%% draw a box of margin width size to see if figure is properly contained within
\newcommand{\marginsizebox}{\draw (0,0)--(\marginparwidth,0)--(\marginparwidth,3)--(0,3)--cycle;}

%%%%
%%%%

\newspecialbox[notempty]{exvideo}{ignored}{240}

\newcommand{\genVideo}[4][]{\exvideo{%
 \ifthenelse{\boolean{latexml}}{%
  \noindent Watch the video:\\%
  \href{#3#1}{#4 from \nolinkurl{#3}}%
  \embedVideo{https://www.youtube.com/v/#2?rel=0}%
 }{%
  \begin{minipage}[t]{2cm}%
  \vspace{-.5\baselineskip}\qrcode{#3}%
  \end{minipage}
  \quad
  \begin{minipage}[t]{.74\linewidth}%
   \noindent Watch the video:\\%
   \href{#3}{#4 at\\\nolinkurl{#3}}%
  \end{minipage}%
 }%
}}

\newcommand{\youtubeVideo}[2]{\genVideo{#1}{https://youtu.be/#1}{#2}}

\newcommand{\jmtVideo}[3]{\genVideo{#1}{http://patrickjmt.com/#2/}{#3}}

\newcommand{\khanVideo}[3]{\genVideo[?utm_campaign=embed]{#1}{https://www.khanacademy.org/video/#2}{#3}}


% \mfigure[graphicsoptions]{offset}{caption}{label}{file}
\newcommand{\mfigure}[5][]{
	\mnote[#2]{\lxfigure{%
		\centering\myincludegraphics[#1]{#5}%
		\captionof{figure}{#3}\label{#4}}%
	}}

% \mtable[offset=0]{caption}{label}{contents}
\newcommand{\mtable}[4][0ex]{
	\mnote[#1]{\lxfigure{%
		\centering\small#4\captionof{figure}{#2}\label{#3}}%
	}}

% \mnote[offset=0]{contents}
\newcommand{\mnote}[2][0ex]{%
	\marginpar{\vspace{#1}%
		\begin{minipage}[c]{\marginparwidth}
		#2
		\end{minipage}%
	}}

% \mfigurethree{mediaoptions}{graphicsoptions}{offset}{caption}{label}{file}
\newcommand{\mfigurethree}[6]%
	{\mnote[#3]{\lxfigure{\centering%
		\ifthenelse{\boolean{in_threeD}}{% in 3D
			\includemedia[#1]{\includegraphics{#6_3D\colornamesuffix}}{#6_3D.prc}
		}{% not
			\myincludegraphics[#2]{#6}
		}%
		\captionof{figure}{#4}\label{#5}
	}}}


\newenvironment{lxfigure}{%
	\iflatexml\begin{figure}[!h]\else\vspace{\baselineskip}\fi%
}{%
	\iflatexml\end{figure}\else\vspace{\baselineskip}\fi
}

\newcommand{\tbox}[1]{\begin{tabular}{c}#1\end{tabular}} % a tall box
\newcommand*{\zbox}[1]{\makebox[0pt][c]{#1}} % a zero width box


\newboolean{chapter_already_has_exercises}

\newcommand*{\apexchapter}[2]{
 \clearpage\thispagestyle{empty}\cleardoublepage
 \chapter{#1}\label{#2}
 \thispagestyle{empty}
 \setboolean{chapter_already_has_exercises}{false}
 \ifthenelse{\boolean{latexml}}{\section*{Chapter Introduction}}{}
}


\newcounter{flushcounter}
\newcommand{\flushinner}[1]{%
	\stepcounter{flushcounter}%
	\makebox[0pt]{\label{label\theflushcounter}}%
	\ifthenelse{\boolean{latexml}\OR\isodd{\pageref{label\theflushcounter}}}{%
%		\makebox[.99\linewidth][l]{#1}%
%		\makebox[.99\linewidth][l]{\parbox{.99\linewidth}{#1}}%
		\makebox[.99\linewidth][l]{\begin{tabular}{c}#1\end{tabular}}%
}{%
%		\makebox[.99\linewidth][r]{#1}%
%		\makebox[.99\linewidth][r]{\parbox{\textwidth}{#1}}%
		\makebox[.99\linewidth][r]{\begin{tabular}{c}#1\end{tabular}}%
	}}
\newcommand{\flushouter}[1]{%
	\stepcounter{flushcounter}%
	\makebox[0pt]{\label{label\theflushcounter}}%
	\ifthenelse{\boolean{latexml}\OR\isodd{\pageref{label\theflushcounter}}}{%
		\makebox[.99\linewidth][r]{\begin{tabular}{c}#1\end{tabular}}%
	}{%
		\makebox[.99\linewidth][l]{\begin{tabular}{c}#1\end{tabular}}%
	}}
\newcommand{\flushinnerequ}[1]{\flushinner{\vtop{#1}}}

\newcommand{\prereqIntro}{The material in this section provides a basic review of and practice problems for pre-calculus skills essential to your success in Calculus. You should take time to review this section and work the suggested problems (checking your answers against those in the back of the book). Since this content is a pre-requisite for Calculus, reviewing and mastering these skills are considered your responsibility. This means that minimal, and in some cases no, class time will be devoted to this section. When you identify areas that you need help with we strongly urge you to seek assistance outside of class from your instructor or other student tutoring service.\bigskip}


\ifthenelse{\boolean{xetex}}%
	{%
	\sffamily
	%%\usepackage{fontspec}
	\usepackage{mathspec}
	\setallmainfonts[Mapping=tex-text]{Calibri}
	\setmainfont[Mapping=tex-text]{Calibri}
	\setsansfont[Mapping=tex-text]{Calibri}
	\setmathsfont(Greek){[cmmi10]}}
	{\ifthenelse{\boolean{latexml}}{}{Please compile with XeLaTeX}}
	
%\ifthenelse{\boolean{luatex}}%
%	{%
%	\sffamily
%	\usepackage{fontspec}
%	\usepackage{unicode-math}
%	%\usepackage{mathspec}
%	%\setallmainfonts[Mapping=tex-text]{Calibri}
%	\setmainfont{Calibri}
%	%\setsansfont[Mapping=tex-text]{Calibri}
%	\setmathfont[range=\mathup]{Calibri}
%	\setmathfont[range=\mathit]{Calibri Italic}
%	}
%	{}

\usepackage[bookmarksnumbered,hidelinks,pdfstartview=FitH]{hyperref}
